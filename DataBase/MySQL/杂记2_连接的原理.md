## 连接查询的原理

>本质上来讲，连接就是把各个表的记录都取出来依次进行匹配，并把匹配后的组合发给客户端，如果不加过滤条件，产生的结果就是笛卡尔积。

### 内连接外连接的区别

> 内连接和外连接的根本区别在于，在驱动表中的记录不符合on子句的连接条件，内连接不会把该条记录加入到结果集，而外连接会。

- 在MySQL里面，外连接分为左外连接和右外连接。
- 根据选用驱动表的不同，外连接可以细分为左连接和右连接。在内连接中，会基于成本选择出最优的驱动表。若驱动表的记录在被驱动表中没有找不到匹配的记录，则该记录不会加入到最后的结果集

- 左连接就是选取左侧的表作为驱动表，右连接就是选取右侧的表作为驱动表。
- 在外连接中，如果不想驱动表中的记录全部加入到结果集中，使用where关键字过滤。在内连接的场景下，where和on关键字没有区别。

### 循环嵌套连接

对于连接查询来说，驱动表只会被访问一次，被驱动表会被访问N次。每当从驱动表得到了一条记录，就根据这条记录立即到被驱动表中查询一次，如果得到了匹配的记录，就把组合后得结果返回给客户端。然后再到驱动表获取下一条记录。

访问驱动表的时候会采用最佳的单表访问策略。

访问被驱动表可以建立合适的索引来加快匹配的速度。

### 基于块的循环嵌套连接

驱动表有多少条记录，就有可能加载被驱动表到内存多少次。MySQL在执行连接查询前申请一块固定大小的JoinBuffer。先把若干个驱动表结果集里面的记录存放在buffer中，然后开始扫描被驱动表，每一条被驱动表的记录可以一次性与多条驱动表的记录匹配，减少被驱动表的io次数。